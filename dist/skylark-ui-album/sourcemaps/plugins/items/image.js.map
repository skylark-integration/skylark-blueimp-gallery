{"version":3,"sources":["plugins/items/image.js"],"names":["define","langx","noder","$","Album","ImageItemFactory","ItemFactoryBase","inherit","klassName","options","stretchImages","initOptions","this","overrided","mixin","prototype","render","obj","callback","callbackWrapper","event","called","type","target","element","img","off","backgroundSize","style","background","url","title","altText","createElement","album","getItemProperty","urlProperty","titleProperty","altTextProperty","draggable","alt","on","src","pluginInfo","name","mimeType","ctor","installPlugin"],"mappings":";;;;;;;AAAAA,QACC,sBACA,sBACA,sBACA,eACE,SAAUC,EAAOC,EAAOC,EAAGC,GAC7B,GAAIC,GAAmBD,EAAME,gBAAgBC,SAC5CC,UAAW,mBACXC,SAMCC,eAAe,GAGhBC,YAAa,SAAUF,GACtBG,KAAKC,YACLD,KAAKH,QAAUR,EAAMa,MAAMF,KAAKH,QAASJ,EAAiBU,UAAUN,QAASA,IAG9EO,OAAQ,SAAUC,EAAKC,GAWtB,QAASC,GAAgBC,GACnBC,IACJD,GACCE,KAAMF,EAAME,KACZC,OAAQC,GAGTH,GAAS,EACTlB,EAAEsB,GAAKC,IAAI,aAAcP,GACrBQ,GACgB,SAAfP,EAAME,OACTE,EAAQI,MAAMC,WAAa,QAAUC,EAAM,sBAC3CN,EAAQI,MAAMD,eAAiBA,GAGjCT,EAASE,IAzBX,GAKCC,GACAG,EACAO,EACAC,EAPAP,EAAMvB,EAAM+B,cAAc,OAE1BH,GADQlB,KAAKsB,MACPjB,GACNU,EAAiBf,KAAKH,QAAQC,aA+C/B,OAvBmB,gBAARoB,KACVA,EAAMlB,KAAKuB,gBAAgBlB,EAAKL,KAAKH,QAAQ2B,aAC7CL,EAAQnB,KAAKuB,gBAAgBlB,EAAKL,KAAKH,QAAQ4B,eAC/CL,EACCpB,KAAKuB,gBAAgBlB,EAAKL,KAAKH,QAAQ6B,kBAAoBP,GAEzDJ,KAAmB,IACtBA,EAAiB,WAEdA,EACHH,EAAUtB,EAAM+B,cAAc,QAE9BT,EAAUC,EACVA,EAAIc,WAAY,GAEbR,IACHP,EAAQO,MAAQA,GAEbC,IACHR,EAAQgB,IAAMR,GAEf7B,EAAEsB,GAAKgB,GAAG,aAActB,GACxBM,EAAIiB,IAAMZ,EACHN,KAKLmB,GACHC,KAAM,QACNC,SAAU,QACVC,KAAMzC,EAKP,OAFAD,GAAM2C,cAAc,QAASJ,GAEtBA","file":"../../../plugins/items/image.js","sourcesContent":["define([\r\n\t\"skylark-langx/langx\",\r\n\t\"skylark-utils/noder\",\r\n\t\"skylark-utils/query\",\r\n\t'../../Album',\r\n], function (langx, noder, $, Album) {\r\n\tvar ImageItemFactory = Album.ItemFactoryBase.inherit({\r\n\t\tklassName: \"ImageItemFactory\",\r\n\t\toptions: {\r\n\t\t\t// Defines if images should be stretched to fill the available space,\r\n\t\t\t// while maintaining their aspect ratio (will only be enabled for browsers\r\n\t\t\t// supporting background-size=\"contain\", which excludes IE < 9).\r\n\t\t\t// Set to \"cover\", to make images cover all available space (requires\r\n\t\t\t// support for background-size=\"cover\", which excludes IE < 9):\r\n\t\t\tstretchImages: false\r\n\t\t},\r\n\r\n\t\tinitOptions: function (options) {\r\n\t\t\tthis.overrided();\r\n\t\t\tthis.options = langx.mixin(this.options, ImageItemFactory.prototype.options, options);\r\n\t\t},\r\n\r\n\t\trender: function (obj, callback) {\r\n\t\t\tvar that = this,\r\n\t\t\t\timg = noder.createElement(\"img\"),\r\n\t\t\t\talbum = this.album,\r\n\t\t\t\turl = obj,\r\n\t\t\t\tbackgroundSize = this.options.stretchImages,\r\n\t\t\t\tcalled,\r\n\t\t\t\telement,\r\n\t\t\t\ttitle,\r\n\t\t\t\taltText;\r\n\r\n\t\t\tfunction callbackWrapper(event) {\r\n\t\t\t\tif (!called) {\r\n\t\t\t\t\tevent = {\r\n\t\t\t\t\t\ttype: event.type,\r\n\t\t\t\t\t\ttarget: element\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcalled = true\r\n\t\t\t\t\t$(img).off('load error', callbackWrapper)\r\n\t\t\t\t\tif (backgroundSize) {\r\n\t\t\t\t\t\tif (event.type === 'load') {\r\n\t\t\t\t\t\t\telement.style.background = 'url(\"' + url + '\") center no-repeat'\r\n\t\t\t\t\t\t\telement.style.backgroundSize = backgroundSize\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcallback(event)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (typeof url !== 'string') {\r\n\t\t\t\turl = this.getItemProperty(obj, this.options.urlProperty);\r\n\t\t\t\ttitle = this.getItemProperty(obj, this.options.titleProperty);\r\n\t\t\t\taltText =\r\n\t\t\t\t\tthis.getItemProperty(obj, this.options.altTextProperty) || title;\r\n\t\t\t}\r\n\t\t\tif (backgroundSize === true) {\r\n\t\t\t\tbackgroundSize = 'contain';\r\n\t\t\t}\r\n\t\t\tif (backgroundSize) {\r\n\t\t\t\telement = noder.createElement(\"div\");\r\n\t\t\t} else {\r\n\t\t\t\telement = img;\r\n\t\t\t\timg.draggable = false;\r\n\t\t\t}\r\n\t\t\tif (title) {\r\n\t\t\t\telement.title = title;\r\n\t\t\t}\r\n\t\t\tif (altText) {\r\n\t\t\t\telement.alt = altText;\r\n\t\t\t}\r\n\t\t\t$(img).on('load error', callbackWrapper);\r\n\t\t\timg.src = url\r\n\t\t\treturn element;\r\n\t\t}\r\n\r\n\t});\r\n\r\n\tvar pluginInfo = {\r\n\t\tname: \"image\",\r\n\t\tmimeType: \"image\",\r\n\t\tctor: ImageItemFactory\r\n\t};\r\n\r\n\tAlbum.installPlugin(\"items\", pluginInfo);\r\n\r\n\treturn pluginInfo;\r\n\r\n});"]}